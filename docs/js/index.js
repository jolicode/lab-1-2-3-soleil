"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();!function(t){function e(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(e,i){_classCallCheck(this,t),this.canvas={motion:document.getElementById("motion"),capture:document.createElement("canvas"),diff:document.createElement("canvas")};var s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=0;a=s>2500?1500:s>930&&s<=2500?Math.floor(.6*s):Math.floor(.9*s);var n=this.gcd(e,i);this.captureIntervalTime=100,this.canvasWidth=a,this.canvasHeight=a/(e/n)*(i/n),this.isReadyToDiff=!1,this.pixelDiffThreshold=200,this.scoreThreshold=32,this.motionCoords=[],this.savedCoords=[],this.diffSwitch=!1,this.drawSwitch=!1,this.canvas.capture.width=this.canvasWidth,this.canvas.capture.height=this.canvasHeight,this.captureContext=this.canvas.capture.getContext("2d"),this.canvas.diff.width=this.canvasWidth,this.canvas.diff.height=this.canvasHeight,this.diffContext=this.canvas.diff.getContext("2d"),this.canvas.motion.width=this.canvasWidth,this.canvas.motion.height=this.canvasHeight,this.motionContext=this.canvas.motion.getContext("2d")}return _createClass(t,[{key:"start",value:function(t){var e=this;this.canvas.motion.classList.add("visible"),this.captureInterval=setInterval(function(){e.capture(t)},this.captureIntervalTime)}},{key:"capture",value:function(t){this.captureContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight);for(var e=this.captureContext.getImageData(0,0,this.canvasWidth,this.canvasHeight),i=e.data,s=0;s<i.length;s+=4){var a=i[s],n=i[s+1],o=i[s+2],r=parseInt((a+n+o)/3);i[s]=r,i[s+1]=r,i[s+2]=r}this.motionContext.putImageData(e,0,0),this.diffContext.globalCompositeOperation="difference",this.diffContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight);var c=this.diffContext.getImageData(0,0,this.canvasWidth,this.canvasHeight);if(this.isReadyToDiff&&this.diffSwitch)for(var l=c.data,h=0;h<l.length;h+=4)if(.6*l[h]+.6*l[h+1]+.6*l[h+2]>=this.pixelDiffThreshold){var d=this.calculateCoordinates(h/4);this.motionCoords.push({x:d.x,y:d.y})}if(this.isReadyToDiff){this.motionCoords.length>1500&&this.saveDiff();for(var v=0;v<this.savedCoords.length;v++)this.savedCoords[v].x<this.canvasWidth/2?this.motionContext.fillStyle="#FFF200":this.motionContext.fillStyle="#F46060",this.motionContext.fillRect(this.savedCoords[v].x-2,this.savedCoords[v].y-2,4,4)}this.motionContext.beginPath(),this.motionContext.moveTo(this.canvasWidth/2,0),this.motionContext.lineTo(this.canvasWidth/2,this.canvasHeight),this.motionContext.strokeStyle="#ffffff",this.motionContext.stroke(),this.diffContext.globalCompositeOperation="source-over",this.diffContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight),this.isReadyToDiff=!0}},{key:"calculateCoordinates",value:function(t){return{x:t%this.canvasWidth,y:Math.floor(t/this.canvasWidth)}}},{key:"saveDiff",value:function(){this.savedCoords=this.savedCoords.concat(this.motionCoords),this.reset(!1)}},{key:"reset",value:function(t){this.motionCoords=[],this.savedCoords=t?[]:this.savedCoords}},{key:"stop",value:function(){this.captureInterval&&(clearInterval(this.captureInterval),this.motionContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.canvas.motion.classList.remove("visible"),this.isReadyToDiff=!1)}},{key:"gcd",value:function(t,e){return 0==e?t:this.gcd(e,t%e)}}]),t}();e.default=s},function(t,e,i){i(0),t.exports=i(2)},function(t,e,i){function s(t){f=!0,u=!1;var e=t;if(!e)throw"Cannot start after init fail";d.video.addEventListener("canplay",a),d.video.srcObject=e,d.video.onloadedmetadata=function(){h=new l.default(this.videoWidth,this.videoHeight)}}function a(){d.video.removeEventListener("canplay",a),h.start(d.video);var t=0,e=2;g=setInterval(function(){if(t>0&&t<v.game.sec){t+=1,v.game.el.innerHTML=t;var i=Math.floor(4*Math.random()+2);switch(e){case 1:h.reset(!1);break;case 2:c(t);break;case 3:r(i)}}else if(0!=t||u){if(t==v.game.sec&&!u){switch(v.game.el.innerHTML="",e){case 1:h.reset(!1),h.savedCoords.length>0?(e=3,v.game.sec=5):e=2;break;case 2:v.game.el.innerHTML="SOLEIL",c("soleil"),e=1;break;case 3:d.step.innerHTML="Ready ?",e=2,v.game.sec=3}t=0}}else switch(t+=1,v.game.el.innerHTML=t,e){case 1:d.step.innerHTML="Watching",d.body.classList.add("watch"),y=!1,h.diffSwitch=!0,r(2);break;case 2:d.step.innerHTML="",r(1),h.diffSwitch=!1,h.reset(!0),y=!0,d.body.classList.remove("watch"),d.body.classList.remove("on"),c(t);break;case 3:d.step.innerHTML="Extra time",d.body.classList.remove("watch"),d.body.classList.add("on"),r(3),h.diffSwitch=!1}},1e3)}function n(t){d.rules.innerHTML=t}function o(t,e){var i=t.sec,s=setInterval(function(){i>=0?(t.el.innerHTML=i,i-=1):(t.el.innerHTML=0,clearInterval(s),e())},1e3)}function r(t){for(var e=0;e<d.eyes.length;e++)d.eyes[e].dataset.number==t?d.eyes[e].classList.add("visible"):d.eyes[e].classList.remove("visible")}function c(t){var e=window.speechSynthesis,i=new SpeechSynthesisUtterance;i.text=t,i.lang="fr-FR",e.speak(i)}Object.defineProperty(e,"__esModule",{value:!0});var l=i(0),h=[],d={body:document.getElementById("body"),video:document.getElementById("video"),playButton:document.querySelector(".play-button"),eyes:document.querySelectorAll(".eyesPicto"),rules:document.querySelector(".rules"),alerts:document.querySelector(".alerts"),step:document.querySelector(".step"),win:document.querySelector(".win")},v={game:{el:document.getElementById("gameCount"),sec:3},start:{el:document.getElementById("start"),sec:10}},u=!1,f=!1,m=!0,g=void 0,y=!1;d.playButton.addEventListener("click",function(t){t.preventDefault();var e={audio:!1,video:{width:{min:640,ideal:1280,max:1920},height:{min:400,ideal:720},facingMode:"user",frameRate:{max:25}}};d.playButton.classList.toggle("visible"),o(v.start,function(){m?(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise(function(i,s){e.call(navigator,t,i,s)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia(e).then(s).catch(n),m=!1):(f=!0,u=!1,a()),v.start.el.classList.toggle("visible"),d.win.classList.remove("visible"),d.rules.classList.toggle("out"),d.alerts.classList.toggle("out")})}),document.onkeydown=function(t){"32"==(t=t||window.event).keyCode&&f&&y&&(f=!1,u=!0,h.stop(),clearInterval(g),d.win.classList.add("visible"),d.playButton.innerHTML="Re-play",d.playButton.classList.toggle("visible"),d.rules.classList.toggle("out"),d.alerts.classList.toggle("out"),v.start.el.classList.toggle("visible"),r(-1),v.start.el.innerHTML=10)}}]);