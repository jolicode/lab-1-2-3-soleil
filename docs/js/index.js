"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();!function(t){function e(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(e,i){_classCallCheck(this,t),this.canvas={motion:document.getElementById("motion"),capture:document.createElement("canvas"),diff:document.createElement("canvas")};var s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=0;a=s>2500?1500:s>930&&s<=2500?Math.floor(.6*s):Math.floor(.9*s);var n=this.gcd(e,i);this.captureIntervalTime=100,this.canvasWidth=a,this.canvasHeight=a/(e/n)*(i/n),this.isReadyToDiff=!1,this.pixelDiffThreshold=200,this.scoreThreshold=32,this.motionCoords=[],this.savedCoords=[],this.diffSwitch=!1,this.drawSwitch=!1,this.canvas.capture.width=this.canvasWidth,this.canvas.capture.height=this.canvasHeight,this.captureContext=this.canvas.capture.getContext("2d"),this.canvas.diff.width=this.canvasWidth,this.canvas.diff.height=this.canvasHeight,this.diffContext=this.canvas.diff.getContext("2d"),this.canvas.motion.width=this.canvasWidth,this.canvas.motion.height=this.canvasHeight,this.motionContext=this.canvas.motion.getContext("2d")}return _createClass(t,[{key:"start",value:function(t){var e=this;this.canvas.motion.classList.add("visible"),this.captureInterval=setInterval(function(){e.capture(t)},this.captureIntervalTime)}},{key:"capture",value:function(t){this.captureContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight);for(var e=this.captureContext.getImageData(0,0,this.canvasWidth,this.canvasHeight),i=e.data,s=0;s<i.length;s+=4){var a=i[s],n=i[s+1],o=i[s+2],r=parseInt((a+n+o)/3);i[s]=r,i[s+1]=r,i[s+2]=r}this.motionContext.putImageData(e,0,0),this.diffContext.globalCompositeOperation="difference",this.diffContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight);var c=this.diffContext.getImageData(0,0,this.canvasWidth,this.canvasHeight);if(this.isReadyToDiff&&this.diffSwitch)for(var l=c.data,d=0;d<l.length;d+=4)if(.6*l[d]+.6*l[d+1]+.6*l[d+2]>=this.pixelDiffThreshold){var h=this.calculateCoordinates(d/4);this.motionCoords.push({x:h.x,y:h.y})}if(this.isReadyToDiff){this.motionCoords.length>1500&&this.saveDiff();for(var v=0;v<this.savedCoords.length;v++)this.savedCoords[v].x<this.canvasWidth/2?this.motionContext.fillStyle="#FFF200":this.motionContext.fillStyle="#F46060",this.motionContext.fillRect(this.savedCoords[v].x-2,this.savedCoords[v].y-2,4,4)}this.motionContext.beginPath(),this.motionContext.moveTo(this.canvasWidth/2,0),this.motionContext.lineTo(this.canvasWidth/2,this.canvasHeight),this.motionContext.strokeStyle="#ffffff",this.motionContext.stroke(),this.diffContext.globalCompositeOperation="source-over",this.diffContext.drawImage(t,0,0,this.canvasWidth,this.canvasHeight),this.isReadyToDiff=!0}},{key:"calculateCoordinates",value:function(t){return{x:t%this.canvasWidth,y:Math.floor(t/this.canvasWidth)}}},{key:"saveDiff",value:function(){this.savedCoords=this.savedCoords.concat(this.motionCoords),this.reset(!1)}},{key:"reset",value:function(t){this.motionCoords=[],this.savedCoords=t?[]:this.savedCoords}},{key:"stop",value:function(){this.captureInterval&&(clearInterval(this.captureInterval),this.motionContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.canvas.motion.classList.remove("visible"),this.isReadyToDiff=!1)}},{key:"gcd",value:function(t,e){return 0==e?t:this.gcd(e,t%e)}}]),t}();e.default=s},function(t,e,i){i(0),t.exports=i(2)},function(t,e,i){function s(t){var e=t;if(!e)throw"Cannot start after init fail";u.video.addEventListener("canplay",a),u.video.srcObject=e,u.video.onloadedmetadata=function(){v=new h.default(this.videoWidth,this.videoHeight)}}function a(){u.video.removeEventListener("canplay",a),g=!0,m=!1,r(f.start,function(){f.start.el.classList.toggle("visible"),u.win.classList.remove("visible"),u.rules.classList.toggle("out"),u.alerts.classList.toggle("out"),n()})}function n(){v.start(u.video);var t=0,e=2;p=setInterval(function(){if(t>0&&t<f.game.sec){t+=1,f.game.el.innerHTML=t;var i=Math.floor(4*Math.random()+2);switch(e){case 1:v.reset(!1);break;case 2:d(t);break;case 3:c(i)}}else if(0!=t||m){if(t==f.game.sec&&!m){switch(f.game.el.innerHTML="",e){case 1:v.reset(!1),v.savedCoords.length>0?(e=3,f.game.sec=5):e=2;break;case 2:f.game.el.innerHTML="SOLEIL",d("soleil"),e=1;break;case 3:u.step.innerHTML="Ready ?",e=2,f.game.sec=3}t=0}}else switch(t+=1,f.game.el.innerHTML=t,e){case 1:u.step.innerHTML="Watching",u.body.classList.add("watch"),C=!1,v.diffSwitch=!0,c(2);break;case 2:u.step.innerHTML="",c(1),v.diffSwitch=!1,v.reset(!0),C=!0,u.body.classList.remove("watch"),u.body.classList.remove("on"),d(t);break;case 3:u.step.innerHTML="Extra time",u.body.classList.remove("watch"),u.body.classList.add("on"),c(3),v.diffSwitch=!1}},1e3)}function o(t){u.rules.innerHTML=t}function r(t,e){var i=t.sec,s=setInterval(function(){i>=0?(t.el.innerHTML=i,i-=1):(t.el.innerHTML=0,clearInterval(s),e())},1e3)}function c(t){for(var e=0;e<u.eyes.length;e++)u.eyes[e].dataset.number==t?u.eyes[e].classList.add("visible"):u.eyes[e].classList.remove("visible")}function l(){g&&C&&(g=!1,m=!0,v.stop(),clearInterval(p),u.win.classList.add("visible"),u.playButton.innerHTML="Re-play",u.playButton.classList.toggle("visible"),u.rules.classList.toggle("out"),u.alerts.classList.toggle("out"),f.start.el.classList.toggle("visible"),c(-1),f.start.el.innerHTML=10)}function d(t){var e=window.speechSynthesis,i=new SpeechSynthesisUtterance;i.text=t,i.lang="fr-FR",e.speak(i)}Object.defineProperty(e,"__esModule",{value:!0});var h=i(0),v=[],u={body:document.getElementById("body"),video:document.getElementById("video"),playButton:document.querySelector(".play-button"),eyes:document.querySelectorAll(".eyesPicto"),rules:document.querySelector(".rules"),alerts:document.querySelector(".alerts"),step:document.querySelector(".step"),win:document.querySelector(".win")},f={game:{el:document.getElementById("gameCount"),sec:3},start:{el:document.getElementById("start"),sec:10}},m=!1,g=!1,y=!0,p=void 0,C=!1;u.playButton.addEventListener("click",function(t){if(t.preventDefault(),u.playButton.classList.toggle("visible"),y){var e={audio:!1,video:{width:{min:640,ideal:1280,max:1920},height:{min:400,ideal:720},facingMode:"user",frameRate:{max:25}}};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise(function(i,s){e.call(navigator,t,i,s)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia(e).then(s).catch(o),y=!1}else a()}),document.onkeydown=function(t){"32"==(t=t||window.event).keyCode&&l()},u.body.addEventListener("touchend",l,!1)}]);