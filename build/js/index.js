"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();!function(e){function t(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t,i){_classCallCheck(this,e),this.canvas={motion:document.getElementById("motion"),capture:document.createElement("canvas"),diff:document.createElement("canvas")};var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=0;s=a>2500?1500:a>930&&a<=2500?Math.floor(.6*a):Math.floor(.9*a);var n=this.gcd(t,i);this.captureIntervalTime=100,this.canvasWidth=s,this.canvasHeight=s/(t/n)*(i/n),this.isReadyToDiff=!1,this.pixelDiffThreshold=200,this.scoreThreshold=32,this.motionCoords=[],this.savedCoords=[],this.diffSwitch=!1,this.drawSwitch=!1,this.canvas.capture.width=this.canvasWidth,this.canvas.capture.height=this.canvasHeight,this.captureContext=this.canvas.capture.getContext("2d"),this.canvas.diff.width=this.canvasWidth,this.canvas.diff.height=this.canvasHeight,this.diffContext=this.canvas.diff.getContext("2d"),this.canvas.motion.width=this.canvasWidth,this.canvas.motion.height=this.canvasHeight,this.motionContext=this.canvas.motion.getContext("2d")}return _createClass(e,[{key:"start",value:function(e){var t=this;this.canvas.motion.classList.add("visible"),this.captureInterval=setInterval(function(){t.capture(e)},this.captureIntervalTime)}},{key:"capture",value:function(e){this.captureContext.drawImage(e,0,0,this.canvasWidth,this.canvasHeight);for(var t=this.captureContext.getImageData(0,0,this.canvasWidth,this.canvasHeight),i=t.data,a=0;a<i.length;a+=4){var s=i[a],n=i[a+1],o=i[a+2],r=parseInt((s+n+o)/3);i[a]=r,i[a+1]=r,i[a+2]=r}this.motionContext.putImageData(t,0,0),this.diffContext.globalCompositeOperation="difference",this.diffContext.drawImage(e,0,0,this.canvasWidth,this.canvasHeight);var c=this.diffContext.getImageData(0,0,this.canvasWidth,this.canvasHeight);if(this.isReadyToDiff&&this.diffSwitch)for(var l=c.data,d=0;d<l.length;d+=4)if(.6*l[d]+.6*l[d+1]+.6*l[d+2]>=this.pixelDiffThreshold){var h=this.calculateCoordinates(d/4);this.motionCoords.push({x:h.x,y:h.y})}if(this.isReadyToDiff)for(var v=0;v<this.savedCoords.length;v++)this.savedCoords[v].x<this.canvasWidth/2?this.motionContext.fillStyle="#FFF200":this.motionContext.fillStyle="#F46060",this.motionContext.fillRect(this.savedCoords[v].x-2,this.savedCoords[v].y-2,4,4);this.diffContext.globalCompositeOperation="source-over",this.diffContext.drawImage(e,0,0,this.canvasWidth,this.canvasHeight),this.isReadyToDiff=!0}},{key:"calculateCoordinates",value:function(e){return{x:e%this.canvasWidth,y:Math.floor(e/this.canvasWidth)}}},{key:"saveDiff",value:function(){this.savedCoords=this.savedCoords.concat(this.motionCoords),this.reset(!1)}},{key:"reset",value:function(e){this.motionCoords=[],this.savedCoords=e?[]:this.savedCoords}},{key:"stop",value:function(){this.captureInterval&&(clearInterval(this.captureInterval),this.motionContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.canvas.motion.classList.remove("visible"),this.isReadyToDiff=!1)}},{key:"gcd",value:function(e,t){return 0==t?e:this.gcd(t,e%t)}}]),e}();t.default=a},function(e,t,i){i(0),e.exports=i(2)},function(e,t,i){function a(e){f=!0,u=!1;var t=e;if(!t)throw"Cannot start after init fail";h.video.addEventListener("canplay",s),h.video.srcObject=t,h.video.onloadedmetadata=function(){d=new l.default(this.videoWidth,this.videoHeight)}}function s(){h.video.removeEventListener("canplay",s),d.start(h.video);var e=0;d.diffSwitch=!1;var t=2;g=setInterval(function(){if(e>0&&e<v.game.sec){e+=1,v.game.el.innerHTML=e;var i=Math.floor(4*Math.random()+2);switch(t){case 1:h.step.innerHTML="Watching",d.motionCoords.length>1e3?d.saveDiff():d.reset(!1);break;case 2:h.step.innerHTML="",c(e);break;case 3:h.step.innerHTML="Extra time",r(i)}}else if(0!=e||u){if(e==v.game.sec&&!u){switch(v.game.el.innerHTML="",t){case 1:h.body.classList.remove("watch"),d.savedCoords.length>0?(h.body.classList.add("on"),h.step.innerHTML="Extra time",t=3,v.game.sec=5):(h.step.innerHTML="",t=2);break;case 2:h.step.innerHTML="",v.game.el.innerHTML="SOLEIL",c("soleil"),t=1;break;case 3:h.step.innerHTML="Ready ?",t=2,v.game.sec=3}e=0}}else switch(e+=1,v.game.el.innerHTML=e,t){case 1:h.step.innerHTML="Watching",h.body.classList.add("watch"),p=!1,d.diffSwitch=!0,d.reset(!0),r(2);break;case 2:h.step.innerHTML="",r(1),d.diffSwitch=!1,p=!0,d.reset(!0),h.body.classList.remove("on"),c(e);break;case 3:h.step.innerHTML="Extra time",r(3),d.diffSwitch=!1}},1e3)}function n(e){h.rules.innerHTML=e}function o(e,t){var i=e.sec,a=setInterval(function(){i>=0?(e.el.innerHTML=i,i-=1):(e.el.innerHTML=0,clearInterval(a),t())},1e3)}function r(e){for(var t=0;t<h.eyes.length;t++)h.eyes[t].dataset.number==e?h.eyes[t].classList.add("visible"):h.eyes[t].classList.remove("visible")}function c(e){var t=window.speechSynthesis,i=new SpeechSynthesisUtterance;i.text=e,i.lang="fr-FR",t.speak(i)}Object.defineProperty(t,"__esModule",{value:!0});var l=i(0),d=[],h={body:document.getElementById("body"),video:document.getElementById("video"),playButton:document.querySelector(".play-button"),eyes:document.querySelectorAll(".eyesPicto"),rules:document.querySelector(".rules"),alerts:document.querySelector(".alerts"),step:document.querySelector(".step"),win:document.querySelector(".win")},v={game:{el:document.getElementById("gameCount"),sec:3},start:{el:document.getElementById("start"),sec:10}},u=!1,f=!1,m=!0,g=void 0,p=!1;h.playButton.addEventListener("click",function(e){e.preventDefault();var t={audio:!1,video:{width:{min:640,ideal:1280,max:1920},height:{min:400,ideal:720},facingMode:"user",frameRate:{max:25}}};h.playButton.classList.toggle("visible"),o(v.start,function(){m?(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(i,a){t.call(navigator,e,i,a)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia(t).then(a).catch(n),m=!1):(f=!0,u=!1,s()),v.start.el.classList.toggle("visible"),h.win.classList.remove("visible"),h.rules.classList.toggle("out"),h.alerts.classList.toggle("out")})}),document.onkeydown=function(e){"32"==(e=e||window.event).keyCode&&f&&p&&(f=!1,u=!0,d.stop(),clearInterval(g),h.win.classList.add("visible"),h.playButton.innerHTML="Re-play",h.playButton.classList.toggle("visible"),h.rules.classList.toggle("out"),h.alerts.classList.toggle("out"),v.start.el.classList.toggle("visible"),r(-1),v.start.el.innerHTML=10)}}]);